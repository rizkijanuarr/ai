# ENDPOINT: PROSES 2 - K-FOLD CROSS VALIDATION DENGAN K = 3 DAN 5

---

## ðŸ“Œ OVERVIEW

Endpoint ini mengimplementasikan **Proses 2** dari dokumentasi PENGUJIAN_DATA.md yaitu **K-Fold Cross Validation** dengan k = 3 dan 5.

**Fungsi Utama:**
- Menghitung K-Fold Cross Validation dengan k = 3 dan 5
- Membagi dataset menjadi k bagian (folds) secara acak
- Melakukan evaluasi pada setiap fold
- Menghitung rata-rata metrics dari semua fold
- Menghitung standard deviation untuk mengukur konsistensi model

**Perbedaan dengan Proses 1 (Confusion Matrix):**
- **Proses 1:** Evaluasi 1x pada seluruh dataset
- **Proses 2:** Evaluasi k kali (cross validation) untuk validasi yang lebih robust

---

## ðŸ”— ENDPOINT

**Method:** `POST`
**Path:** `/api/v1/k-fold-cross-validation`
**Tag:** `Evaluation Metrics`
**Description:** Get K-Fold Cross Validation with k=3 and k=5

---

## ðŸ“¥ REQUEST

### Request Body

```json
{
    "is_legal": 0
}
```

**Parameter:**
- `is_legal` (Optional, Integer): Filter data berdasarkan kategori
  - `0` = Illegal only
  - `1` = Legal only
  - `null` atau tidak diisi = Semua data

### Validasi

- `is_legal` harus bernilai `0` atau `1` (jika diisi)
- Jika nilai selain 0 atau 1, akan return error 400

---

## ðŸ“¤ RESPONSE

### 200 - Success - LEGAL

```json
{
    "success": true,
    "message": null,
    "data": {
        "is_legal": 1,
        "keterangan_legal": "Filtered by LEGAL",
        "total_samples": 2463,
        "legal_count": 2463,
        "illegal_count": 0,
        "k_fold_3": {
            "k": 3,
            "fold_results": [
                {
                    "fold": 1,
                    "test_size": 821,
                    "tp": 0,
                    "tn": 821,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                },
                {
                    "fold": 2,
                    "test_size": 821,
                    "tp": 0,
                    "tn": 821,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                },
                {
                    "fold": 3,
                    "test_size": 821,
                    "tp": 0,
                    "tn": 821,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                }
            ],
            "average_accuracy": 1,
            "average_precision": 0,
            "average_recall": 0,
            "average_f1_score": 0,
            "std_accuracy": 0,
            "std_f1_score": 0
        },
        "k_fold_5": {
            "k": 5,
            "fold_results": [
                {
                    "fold": 1,
                    "test_size": 492,
                    "tp": 0,
                    "tn": 492,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                },
                {
                    "fold": 2,
                    "test_size": 492,
                    "tp": 0,
                    "tn": 492,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                },
                {
                    "fold": 3,
                    "test_size": 492,
                    "tp": 0,
                    "tn": 492,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                },
                {
                    "fold": 4,
                    "test_size": 492,
                    "tp": 0,
                    "tn": 492,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                },
                {
                    "fold": 5,
                    "test_size": 495,
                    "tp": 0,
                    "tn": 495,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 0,
                    "recall": 0,
                    "f1_score": 0
                }
            ],
            "average_accuracy": 1,
            "average_precision": 0,
            "average_recall": 0,
            "average_f1_score": 0,
            "std_accuracy": 0,
            "std_f1_score": 0
        },
        "k_fold_3_penjelasan": {
            "accuracy": "Rata-rata accuracy dari 3 fold: 100.00% (Â±0.00%)",
            "precision": "Rata-rata precision dari 3 fold: 0.00%",
            "recall": "Rata-rata recall dari 3 fold: 0.00%",
            "f1_score": "Rata-rata F1-Score dari 3 fold: 0.00% (Â±0.00%)"
        },
        "k_fold_5_penjelasan": {
            "accuracy": "Rata-rata accuracy dari 5 fold: 100.00% (Â±0.00%)",
            "precision": "Rata-rata precision dari 5 fold: 0.00%",
            "recall": "Rata-rata recall dari 5 fold: 0.00%",
            "f1_score": "Rata-rata F1-Score dari 5 fold: 0.00% (Â±0.00%)"
        },
        "k_fold_kesimpulan": {
            "k_fold_3": {
                "fold_1": {
                    "test_size": 821,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=821, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 821 website legal dengan benar (100% accuracy)."
                },
                "fold_2": {
                    "test_size": 821,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=821, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 821 website legal dengan benar (100% accuracy)."
                },
                "fold_3": {
                    "test_size": 821,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=821, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 821 website legal dengan benar (100% accuracy)."
                }
            },
            "k_fold_5": {
                "fold_1": {
                    "test_size": 492,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=492, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 492 website legal dengan benar (100% accuracy)."
                },
                "fold_2": {
                    "test_size": 492,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=492, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 492 website legal dengan benar (100% accuracy)."
                },
                "fold_3": {
                    "test_size": 492,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=492, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 492 website legal dengan benar (100% accuracy)."
                },
                "fold_4": {
                    "test_size": 492,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=492, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 492 website legal dengan benar (100% accuracy)."
                },
                "fold_5": {
                    "test_size": 495,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 0.0%, Recall: 0.0%, F1: 0.0%",
                    "confusion_matrix": "TP=0, TN=495, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mengidentifikasi semua 495 website legal dengan benar (100% accuracy)."
                }
            }
        }
    },
    "errors": null
}
```


### 200 - Success - ILLEGAL

```json
{
    "success": true,
    "message": null,
    "data": {
        "is_legal": 0,
        "keterangan_legal": "Filtered by ILLEGAL",
        "total_samples": 1142,
        "legal_count": 0,
        "illegal_count": 1142,
        "k_fold_3": {
            "k": 3,
            "fold_results": [
                {
                    "fold": 1,
                    "test_size": 380,
                    "tp": 380,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                },
                {
                    "fold": 2,
                    "test_size": 380,
                    "tp": 380,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                },
                {
                    "fold": 3,
                    "test_size": 382,
                    "tp": 382,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                }
            ],
            "average_accuracy": 1,
            "average_precision": 1,
            "average_recall": 1,
            "average_f1_score": 1,
            "std_accuracy": 0,
            "std_f1_score": 0
        },
        "k_fold_5": {
            "k": 5,
            "fold_results": [
                {
                    "fold": 1,
                    "test_size": 228,
                    "tp": 228,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                },
                {
                    "fold": 2,
                    "test_size": 228,
                    "tp": 228,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                },
                {
                    "fold": 3,
                    "test_size": 228,
                    "tp": 228,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                },
                {
                    "fold": 4,
                    "test_size": 228,
                    "tp": 228,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                },
                {
                    "fold": 5,
                    "test_size": 230,
                    "tp": 230,
                    "tn": 0,
                    "fp": 0,
                    "fn": 0,
                    "accuracy": 1,
                    "precision": 1,
                    "recall": 1,
                    "f1_score": 1
                }
            ],
            "average_accuracy": 1,
            "average_precision": 1,
            "average_recall": 1,
            "average_f1_score": 1,
            "std_accuracy": 0,
            "std_f1_score": 0
        },
        "k_fold_3_penjelasan": {
            "accuracy": "Rata-rata accuracy dari 3 fold: 100.00% (Â±0.00%)",
            "precision": "Rata-rata precision dari 3 fold: 100.00%",
            "recall": "Rata-rata recall dari 3 fold: 100.00%",
            "f1_score": "Rata-rata F1-Score dari 3 fold: 100.00% (Â±0.00%)"
        },
        "k_fold_5_penjelasan": {
            "accuracy": "Rata-rata accuracy dari 5 fold: 100.00% (Â±0.00%)",
            "precision": "Rata-rata precision dari 5 fold: 100.00%",
            "recall": "Rata-rata recall dari 5 fold: 100.00%",
            "f1_score": "Rata-rata F1-Score dari 5 fold: 100.00% (Â±0.00%)"
        },
        "k_fold_kesimpulan": {
            "k_fold_3": {
                "fold_1": {
                    "test_size": 380,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=380, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 380 website illegal dengan benar (100% accuracy)."
                },
                "fold_2": {
                    "test_size": 380,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=380, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 380 website illegal dengan benar (100% accuracy)."
                },
                "fold_3": {
                    "test_size": 382,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=382, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 382 website illegal dengan benar (100% accuracy)."
                }
            },
            "k_fold_5": {
                "fold_1": {
                    "test_size": 228,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=228, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 228 website illegal dengan benar (100% accuracy)."
                },
                "fold_2": {
                    "test_size": 228,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=228, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 228 website illegal dengan benar (100% accuracy)."
                },
                "fold_3": {
                    "test_size": 228,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=228, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 228 website illegal dengan benar (100% accuracy)."
                },
                "fold_4": {
                    "test_size": 228,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=228, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 228 website illegal dengan benar (100% accuracy)."
                },
                "fold_5": {
                    "test_size": 230,
                    "metrics_summary": "Accuracy: 100.0%, Precision: 100.0%, Recall: 100.0%, F1: 100.0%",
                    "confusion_matrix": "TP=230, TN=0, FP=0, FN=0",
                    "interpretasi": "Sempurna! Model berhasil mendeteksi semua 230 website illegal dengan benar (100% accuracy)."
                }
            }
        }
    },
    "errors": null
}
```

### 400 - Bad Request

```json
{
    "success": false,
    "message": "Invalid request parameters",
    "data": null,
    "errors": [{
        "code": "INVALID_PARAMETERS",
        "title": "Invalid Parameters",
        "message": "is_legal must be 0 (illegal) or 1 (legal)"
    }]
}
```

### 404 - File Not Found

```json
{
    "success": false,
    "message": "Dataset file not found",
    "data": null,
    "errors": [{
        "code": "FILE_NOT_FOUND",
        "title": "Dataset File Not Found",
        "message": "The merged dataset CSV file could not be found. Please ensure the data has been crawled and merged."
    }]
}
```

### 500 - Internal Server Error

```json
{
    "success": false,
    "message": "K-Fold Cross Validation failed",
    "data": null,
    "errors": [{
        "code": "K_FOLD_ERROR",
        "title": "K-Fold Cross Validation Error",
        "message": "Error details..."
    }]
}
```

---

## ðŸ”„ DATA FLOW

```
1. Client Request
   â†“
2. TugasAkhirControllerImplV1.getKFoldCrossValidation()
   - Validate request
   â†“
3. TugasAkhirServiceImplV1.getKFoldCrossValidation()
   - Load data from CSV
   - Filter by is_legal
   â†“
4. EvaluationServiceV1.k_fold_cross_validation(data, k=3)
   - Shuffle data (seed=42 for reproducibility)
   - Split into 3 folds
   - For each fold:
     * Use fold as test set
     * Calculate confusion matrix
     * Calculate metrics
   - Calculate average & std deviation
   â†“
5. EvaluationServiceV1.k_fold_cross_validation(data, k=5)
   - Same process with 5 folds
   â†“
6. Generate penjelasan for each metric
   â†“
7. Return response dengan field order yang teratur
```

---

## ðŸ§® RUMUS INTI

Dataset $D$ dibagi menjadi $k$ bagian sama besar:

$$D = \{D_1, D_2, \ldots, D_k\}$$

### Model dilatih sebanyak $k$ kali:

â€¢ 1 fold â†’ data uji
â€¢ $k - 1$ fold â†’ data latih

### Rumus rata-rata performa

Misal akurasi tiap fold:

$$Acc_1, Acc_2, \ldots, Acc_k$$

Maka:

$$Accuracy_{avg} = \frac{1}{k} \sum_{i=1}^{k} Acc_i$$

### Standard Deviation

$$\sigma = \sqrt{\frac{1}{k} \sum_{i=1}^{k} (Acc_i - Accuracy_{avg})^2}$$

**Interpretasi:**
- **Std Dev kecil** (< 0.01): Model sangat konsisten
- **Std Dev sedang** (0.01 - 0.05): Model cukup konsisten
- **Std Dev besar** (> 0.05): Model tidak konsisten, perlu investigasi

---

## ðŸ“ FILE-FILE TERKAIT

### REQUEST
**File:** `backend/request/v1/KFoldCrossValidationRequestV1.py`
**Class:** `KFoldCrossValidationRequestV1`
**Fields:** `is_legal: Optional[int]`

### RESPONSE
Response menggunakan `dict` langsung (tidak ada DTO khusus) untuk fleksibilitas dan mempertahankan urutan field.

### EVALUATION SERVICE
**File:** `backend/service/v1/EvaluationServiceV1.py`
**Method:** `k_fold_cross_validation(data: List[dict], k: int) -> dict`
**Fungsi:** Core logic untuk K-Fold Cross Validation

### SERVICE
#### SERVICE INTERFACE
**File:** `backend/service/v1/TugasAkhirServiceV1.py`
**Method:** `getKFoldCrossValidation(request: KFoldCrossValidationRequestV1) -> dict`

#### SERVICE IMPLEMENTATION
**File:** `backend/service/v1/impl/TugasAkhirServiceImplV1.py`
**Method:** `getKFoldCrossValidation(request: KFoldCrossValidationRequestV1) -> dict`
**Fungsi:**
- Load data dari CSV
- Filter berdasarkan is_legal
- Call evaluation service untuk k=3 dan k=5
- Generate penjelasan
- Return response terstruktur

### CONTROLLER
#### CONTROLLER INTERFACE
**File:** `backend/controller/v1/TugasAkhirControllerV1.py`
**Method:** `getKFoldCrossValidation(validation_request: KFoldCrossValidationRequestV1) -> DataResponseParameter[dict]`
**Endpoint:** `POST /api/v1/k-fold-cross-validation`

#### CONTROLLER IMPLEMENTATION
**File:** `backend/controller/v1/impl/TugasAkhirControllerImplV1.py`
**Method:** `getKFoldCrossValidation(validation_request: KFoldCrossValidationRequestV1)`
**Fungsi:**
- Handle request
- Call service
- Return JSON response dengan `json.dumps(sort_keys=False)`
- Error handling (400, 404, 500)

---

## ðŸ“Š PENGUJIAN

### RUMUS K-FOLD CROSS VALIDATION 3 & 5

#### **Konsep Dasar K-Fold Cross Validation**

K-Fold Cross Validation membagi dataset menjadi **k** bagian (folds) yang sama besar, kemudian melakukan evaluasi sebanyak **k** kali dengan menggunakan setiap fold sebagai data test secara bergantian.

**Formula Pembagian Dataset:**

$$D = \{D_1, D_2, \ldots, D_k\}$$

Dimana:
- $D$ = Total dataset
- $k$ = Jumlah fold (3 atau 5)
- $D_i$ = Fold ke-i

**Ukuran setiap fold:**

$$\text{fold\_size} = \left\lfloor \frac{|D|}{k} \right\rfloor$$

Sisa data: $|D| \mod k$ akan ditambahkan ke fold terakhir.

---

#### **K-Fold 3 (k=3)**

##### **Formula Pembagian Dataset ILLEGAL (1142 samples)**

$$\text{fold\_size} = \left\lfloor \frac{1142}{3} \right\rfloor = 380$$

$$\text{sisa} = 1142 \mod 3 = 2$$

**Hasil Pembagian:**
- Fold 1: 380 samples
- Fold 2: 380 samples
- Fold 3: 382 samples (380 + 2 sisa)

**Total:** $380 + 380 + 382 = 1142$ âœ…

##### **Formula Pembagian Dataset LEGAL (2463 samples)**

$$\text{fold\_size} = \left\lfloor \frac{2463}{3} \right\rfloor = 821$$

$$\text{sisa} = 2463 \mod 3 = 0$$

**Hasil Pembagian:**
- Fold 1: 821 samples
- Fold 2: 821 samples
- Fold 3: 821 samples

**Total:** $821 + 821 + 821 = 2463$ âœ…

---

#### **K-Fold 5 (k=5)**

##### **Formula Pembagian Dataset ILLEGAL (1142 samples)**

$$\text{fold\_size} = \left\lfloor \frac{1142}{5} \right\rfloor = 228$$

$$\text{sisa} = 1142 \mod 5 = 2$$

**Hasil Pembagian:**
- Fold 1: 228 samples
- Fold 2: 228 samples
- Fold 3: 228 samples
- Fold 4: 228 samples
- Fold 5: 230 samples (228 + 2 sisa)

**Total:** $228 \times 4 + 230 = 912 + 230 = 1142$ âœ…

##### **Formula Pembagian Dataset LEGAL (2463 samples)**

$$\text{fold\_size} = \left\lfloor \frac{2463}{5} \right\rfloor = 492$$

$$\text{sisa} = 2463 \mod 5 = 3$$

**Hasil Pembagian:**
- Fold 1: 492 samples
- Fold 2: 492 samples
- Fold 3: 492 samples
- Fold 4: 492 samples
- Fold 5: 495 samples (492 + 3 sisa)

**Total:** $492 \times 4 + 495 = 1968 + 495 = 2463$ âœ…

---

#### **Perhitungan Metrics per Fold**

Untuk setiap fold $i$ (dimana $i = 1, 2, \ldots, k$):

**1. Confusion Matrix:**
- $TP_i$ = True Positive (Illegal diprediksi Illegal)
- $TN_i$ = True Negative (Legal diprediksi Legal)
- $FP_i$ = False Positive (Legal diprediksi Illegal)
- $FN_i$ = False Negative (Illegal diprediksi Legal)

**2. Accuracy:**

$$Accuracy_i = \frac{TP_i + TN_i}{TP_i + TN_i + FP_i + FN_i}$$

**3. Precision:**

$$Precision_i = \frac{TP_i}{TP_i + FP_i}$$

**4. Recall:**

$$Recall_i = \frac{TP_i}{TP_i + FN_i}$$

**5. F1-Score:**

$$F1_i = 2 \times \frac{Precision_i \times Recall_i}{Precision_i + Recall_i}$$

---

#### **Perhitungan Average Metrics**

Setelah mendapatkan metrics dari semua fold, hitung rata-rata:

**Average Accuracy:**

$$Accuracy_{avg} = \frac{1}{k} \sum_{i=1}^{k} Accuracy_i$$

**Average Precision:**

$$Precision_{avg} = \frac{1}{k} \sum_{i=1}^{k} Precision_i$$

**Average Recall:**

$$Recall_{avg} = \frac{1}{k} \sum_{i=1}^{k} Recall_i$$

**Average F1-Score:**

$$F1_{avg} = \frac{1}{k} \sum_{i=1}^{k} F1_i$$

---

#### **Perhitungan Standard Deviation**

Standard deviation mengukur konsistensi model di berbagai fold:

$$\sigma_{accuracy} = \sqrt{\frac{1}{k} \sum_{i=1}^{k} (Accuracy_i - Accuracy_{avg})^2}$$

$$\sigma_{f1} = \sqrt{\frac{1}{k} \sum_{i=1}^{k} (F1_i - F1_{avg})^2}$$

**Interpretasi:**
- $\sigma < 0.01$ â†’ Model **sangat konsisten**
- $0.01 \leq \sigma < 0.05$ â†’ Model **cukup konsisten**
- $\sigma \geq 0.05$ â†’ Model **tidak konsisten**, perlu investigasi

---

#### **Contoh Perhitungan: K-Fold 3 untuk ILLEGAL Data**

**Given:**
- Fold 1: $TP_1 = 380, TN_1 = 0, FP_1 = 0, FN_1 = 0$
- Fold 2: $TP_2 = 380, TN_2 = 0, FP_2 = 0, FN_2 = 0$
- Fold 3: $TP_3 = 382, TN_3 = 0, FP_3 = 0, FN_3 = 0$

**Accuracy per Fold:**

$$Accuracy_1 = \frac{380 + 0}{380 + 0 + 0 + 0} = \frac{380}{380} = 1.0$$

$$Accuracy_2 = \frac{380 + 0}{380 + 0 + 0 + 0} = \frac{380}{380} = 1.0$$

$$Accuracy_3 = \frac{382 + 0}{382 + 0 + 0 + 0} = \frac{382}{382} = 1.0$$

**Average Accuracy:**

$$Accuracy_{avg} = \frac{1.0 + 1.0 + 1.0}{3} = \frac{3.0}{3} = 1.0 = 100\%$$

**Standard Deviation:**

$$\sigma_{accuracy} = \sqrt{\frac{(1.0-1.0)^2 + (1.0-1.0)^2 + (1.0-1.0)^2}{3}} = \sqrt{\frac{0}{3}} = 0.0$$

**Hasil:** Model **100% akurat** dan **sangat konsisten** (std dev = 0) âœ…

---

#### **Perbandingan K=3 vs K=5**

| Aspek | K=3 | K=5 |
|-------|-----|-----|
| **Jumlah Evaluasi** | 3x | 5x |
| **Fold Size (ILLEGAL)** | ~380 samples | ~228 samples |
| **Fold Size (LEGAL)** | 821 samples | ~492 samples |
| **Kecepatan** | âœ… Lebih cepat | âŒ Lebih lambat |
| **Robustness** | âš ï¸ Cukup robust | âœ… Lebih robust |
| **Variance** | âš ï¸ Bisa lebih tinggi | âœ… Lebih rendah |
| **Rekomendasi** | Dataset kecil (<1000) | Dataset besar (>1000) |

**Kesimpulan:**
- Untuk dataset ILLEGAL (1142 samples): **K=5 lebih baik** (lebih robust)
- Untuk dataset LEGAL (2463 samples): **K=5 lebih baik** (lebih robust)
- Hasil menunjukkan **kedua k memberikan hasil sempurna** (100% accuracy, std=0)

---

### Test Case 1: K-Fold untuk Data ILLEGAL

**Request:**
```json
{
    "is_legal": 0
}
```

**Actual Result:**
```json
{
    "total_samples": 1142,
    "legal_count": 0,
    "illegal_count": 1142,
    "k_fold_3": {
        "average_accuracy": 1.0,
        "average_precision": 1.0,
        "average_recall": 1.0,
        "average_f1_score": 1.0,
        "std_accuracy": 0.0,
        "std_f1_score": 0.0
    },
    "k_fold_5": {
        "average_accuracy": 1.0,
        "average_precision": 1.0,
        "average_recall": 1.0,
        "average_f1_score": 1.0,
        "std_accuracy": 0.0,
        "std_f1_score": 0.0
    }
}
```

**Analisis:**
- âœ… **Accuracy = 100%** - Model sempurna mendeteksi semua website illegal
- âœ… **Precision = 100%** - Tidak ada false positive (legal yang salah diklasifikasi sebagai illegal)
- âœ… **Recall = 100%** - Tidak ada false negative (illegal yang terlewat)
- âœ… **F1-Score = 100%** - Balance sempurna antara precision dan recall
- âœ… **Std Dev = 0%** - Model sangat konsisten di semua fold
- âœ… **Pembagian Fold:**
  - K=3: 380 + 380 + 382 = 1142 samples âœ…
  - K=5: 228 + 228 + 228 + 228 + 230 = 1142 samples âœ…

**Kesimpulan:**
Model **SEMPURNA** dalam mendeteksi website illegal. Semua website dengan keyword judi/slot/gacor berhasil diidentifikasi dengan benar tanpa error.

---

### Test Case 2: K-Fold untuk Data LEGAL

**Request:**
```json
{
    "is_legal": 1
}
```

**Actual Result:**
```json
{
    "total_samples": 2463,
    "legal_count": 2463,
    "illegal_count": 0,
    "k_fold_3": {
        "average_accuracy": 1.0,
        "average_precision": 0.0,
        "average_recall": 0.0,
        "average_f1_score": 0.0,
        "std_accuracy": 0.0,
        "std_f1_score": 0.0
    },
    "k_fold_5": {
        "average_accuracy": 1.0,
        "average_precision": 0.0,
        "average_recall": 0.0,
        "average_f1_score": 0.0,
        "std_accuracy": 0.0,
        "std_f1_score": 0.0
    }
}
```

**Analisis:**
- âœ… **Accuracy = 100%** - Model sempurna mengidentifikasi semua website legal
- âœ… **TN (True Negative) = 821/821/821** (k=3) - Semua legal diprediksi benar sebagai legal
- âš ï¸ **Precision = 0%** - Karena TP=0 (tidak ada illegal untuk dideteksi)
- âš ï¸ **Recall = 0%** - Karena TP=0 (tidak ada illegal untuk dideteksi)
- âš ï¸ **F1-Score = 0%** - Karena precision & recall = 0
- âœ… **Std Dev = 0%** - Model sangat konsisten
- âœ… **Pembagian Fold:**
  - K=3: 821 + 821 + 821 = 2463 samples âœ…
  - K=5: 492 + 492 + 492 + 492 + 495 = 2463 samples âœ…

**Kesimpulan:**
Model **SEMPURNA** dalam mengidentifikasi website legal. Precision/Recall/F1 = 0% adalah **NORMAL dan BENAR** karena tidak ada data illegal untuk dideteksi (TP=0). Metric yang relevan adalah **Accuracy = 100%** dan **True Negative (TN)**.

**Catatan Penting:**
> Ketika testing dengan `is_legal=1` (hanya data legal), Precision dan Recall akan bernilai 0 karena tidak ada True Positive (TP). Ini adalah behavior yang **benar secara matematis** karena TP hanya terjadi ketika ada data illegal yang berhasil dideteksi. Metric yang relevan untuk data legal adalah **Accuracy** dan **True Negative (TN)**, yang keduanya menunjukkan hasil 100%.

---

## ðŸŽ¯ KESIMPULAN

K-Fold Cross Validation memberikan evaluasi yang lebih **robust dan reliable** dibanding simple train-test split karena:

1. **Mengurangi bias** dari pemilihan data test
2. **Mengukur konsistensi** model di berbagai subset data
3. **Memberikan confidence interval** melalui std deviation
4. **Lebih representatif** untuk performa model di production

---

**Dokumentasi dibuat:** 31 Desember 2024
**Terakhir diupdate:** 31 Desember 2024
